<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.shop.mappers.adminMapper">

<resultMap type="GoodsVO" id="GoodsMap">
	<id column="gdsNum" property="gdsNum" />
	<result column="gdsName" property="gdsName" />
	<result column="cateCode" property="cateCode" />
	<result column="gdsPrice" property="gdsPrice" />
	<result column="gdsStock" property="gdsStock" />
	<result column="gdsDes" property="gdsDes" />
	<result column="gdsImg" property="gdsImg" />
	<result column="gdsDate" property="gdsDate" />
	<result column="gdsThumbImg" property="gdsThumbImg" />
</resultMap>

<resultMap type="CategoryVO" id="CategoryMap">
	<id column="cateCode" property="cateCode" />
	<result column="cateName" property="cateName" />
	<result column="cateCodeRef" property="cateCodeRef" />
</resultMap>

	<!-- 카테고리 호출 -->
	<select id="category" resultType="com.shop.domain.CategoryVO">
		WITH recursive cte AS(
		SELECT cateName, cateCode, cateCodeRef, 1 AS level
		FROM goods_category WHERE cateCodeRef IS null
		UNION ALL	
		SELECT p.cateName, p.cateCode, p.cateCodeRef, 1 + LEVEL as level
		FROM goods_category p INNER JOIN cte
		ON p.cateCodeRef = cte.cateCode
		)	
		SELECT cateName, cateCode, cateCodeRef, LEVEL FROM cte
	</select>

	<!-- 상품 등록 -->
	<insert id="register">
		insert into goods(gdsNum, gdsName, cateCode, gdsPrice, gdsStock, gdsDes, gdsImg, gdsThumbImg)
		values(#{gdsNum}, #{gdsName}, #{cateCode}, #{gdsPrice}, #{gdsStock}, #{gdsDes}, #{gdsImg}, #{gdsThumbImg})
	</insert>
	
	<!-- 상품 목록 
	<select id="goodslist" resultType="com.shop.domain.GoodsVO">
		select gdsNum, gdsName, cateCode, gdsPrice, gdsStock, gdsDes, gdsImg, gdsDate
		from goods
		order by gdsNum desc 
	</select>-->
	

	<!-- 상품 목록 -->
	<select id="goodslist" parameterType="GoodsVO" resultMap="GoodsMap">
		SELECT g.gdsNum, g.gdsName, g.cateCode, g.gdsPrice, g.gdsStock, g.gdsDate, g.gdsThumbImg,
				c.cateCode, c.cateName
		FROM goods g JOIN goods_category c
		ON g.cateCode = c.cateCode
		ORDER BY g.gdsNum desc
	</select>

	<!-- 상품 조회 -->
	<select id="goodsDetail"  parameterType="GoodsVO" resultMap="GoodsMap">
		select g.gdsNum, g.gdsName, g.cateCode, g.gdsPrice, g.gdsStock, g.gdsDes, g.gdsImg, g.gdsDate, g.gdsThumbImg,
				c.cateCode, c.cateName
		from goods g JOIN goods_category c
		ON g.cateCode = c.cateCode
		where gdsNum = #{gdsNum}
	</select>

	<!-- 상품 수정 -->
	<update id="goodsModify">
		update goods
		set	gdsName = #{gdsName},
			cateCode = #{cateCode},
			gdsPrice = #{gdsPrice},
			gdsStock = #{gdsStock},
			gdsDes = #{gdsDes},
			gdsImg = #{gdsImg},
			gdsThumbImg = #{gdsThumbImg}
		where gdsNum = #{gdsNum}
	</update>
	
	<!-- 상품 삭제 -->
	<delete id="goodsDelete">
		delete from goods where gdsNum = #{gdsNum}
	</delete>
</mapper>

